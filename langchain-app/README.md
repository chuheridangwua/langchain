# LangChain 聊天代理应用

这是一个使用LangChain框架构建的智能聊天代理系统。该系统能够通过大语言模型与用户进行交互，并根据需要使用各种工具来辅助回答，包括联网搜索功能。

## 项目结构

```
langchain-app/
│
├── main.py               # 主程序入口
├── sessions/             # 会话历史存储目录
├── src/                  # 源代码目录
│   ├── __init__.py
│   ├── chat.py           # 交互式对话模块
│   ├── models/           # 语言模型相关模块
│   │   ├── __init__.py
│   │   └── llm.py        # 语言模型初始化
│   ├── agents/           # 代理相关模块
│   │   ├── __init__.py
│   │   └── agent.py      # 代理创建和管理
│   ├── tools/            # 工具函数模块
│   │   ├── __init__.py
│   │   ├── base_tools.py # 基础工具定义
│   │   └── tavily_tools.py # 联网搜索工具
│   └── utils/            # 工具函数模块
│       ├── __init__.py
│       ├── callbacks.py  # 回调处理器和日志
│       └── session.py    # 会话管理功能
└── README.md             # 项目说明文件
```

## 功能特点

- 使用大语言模型进行聊天交互
- 支持流式输出响应
- **联网搜索功能** - 可以获取实时信息、新闻和天气等数据
- 可扩展的工具集成框架
- **增强的会话管理** - 支持会话保存、恢复和历史浏览
- **对话历史持久化** - 聊天历史自动保存，可在下次启动时恢复
- 日志记录功能

## 如何使用

1. 确保已安装所需依赖：
   ```bash
   pip install langchain langchain_openai langchain-community tavily-python
   ```

2. 运行程序：
   ```bash
   python main.py
   ```

3. 会话管理：
   - 启动程序时，系统会检查是否有保存的会话
   - 如果有，你可以选择恢复之前的会话或创建新会话
   - 聊天历史会自动保存到 `sessions` 目录
   - 输入 `history` 可以查看当前会话的历史对话记录

4. 开始与AI助手对话。你可以尝试询问:
   - 最新的新闻事件
   - 今天的天气情况
   - 股票市场信息
   - 其他需要联网查询的内容

5. 会话命令：
   - 输入 `history` 或 `histroy` (支持拼写错误) 查看当前会话的历史对话记录
   - 输入"退出"、"exit"、"quit"或"q"可退出程序

## 会话管理

系统会为每个会话分配一个唯一的ID，格式为 `session_YYYYMMDDHHMMSS`。会话数据保存在 `sessions` 目录中，以JSON格式存储。

### 会话功能

- **自动保存** - 每次对话后会自动保存聊天历史
- **会话恢复** - 启动时可选择恢复之前的会话
- **历史浏览** - 可以随时查看当前会话的历史记录
- **会话持久化** - 即使程序关闭，会话信息也不会丢失

## 扩展工具

要添加新工具，请在 `src/tools/` 目录下创建新的工具模块，并在 `src/tools/__init__.py` 中导出。然后在 `src/agents/agent.py` 中将新工具添加到工具列表中。

### 已集成的工具
1. **当前时间工具** - 获取系统当前时间和日期
2. **Tavily搜索工具** - 提供联网搜索功能，获取实时信息
3. **Python代码工具** - 生成和执行Python代码

示例：
```python
@tool(description="工具功能描述")
def new_tool(parameter: str) -> str:
    """新工具的功能描述"""
    # 工具实现逻辑
    return f"工具结果: {parameter}"
``` 